---
title: Draft receiver locations
echo: false
warning: false
message: false
---

```{r}
library(sf)
library(leaflet)
library(dplyr)
```

```{r}
# towers <- st_read(tar_read(usw_locations),
#                   layer = 'WTG_Layout_2022_0111',
#                   quiet = T)
wms_enc <- 'https://gis.charttools.noaa.gov/arcgis/rest/services/MCS/ENCOnline/MapServer/exts/MaritimeChartService/WMSServer'
zones <- st_read('usw_buildout_zones.gpkg',
                 quiet = T)
mmm <- read.csv('MD_PAM_AllStations_BOEMFinal_D1_2.csv',
                na.strings = '') |> 
  st_as_sf(coords = c('Longitude', 'Latitude'), crs = 4326) |> 
  filter(Device %in% c('MARU', 'C-POD', 'FPOD'),
         Site != 'T-3')

## Add VR2ARs
k <- mmm |> 
  filter(StationName == 'A-5C') |> 
  st_transform(6487) |> 
  st_geometry() + list(c(4000, 0), c(-4000, 0)) 
st_crs(k) <- 6487
k <- st_transform(k, 4326)
k <- st_as_sf(k)
k$StationName <- c('V4', 'V5')
k$Device <- 'VR2AR'
k$geometry <- k$x
k$x <- NULL

mmm <- bind_rows(mmm, k)


## Add extra FPOD site. this is hacky and being called CPOD to get the colors right
k <- mmm |> 
  filter(StationName == 'T-3*M') |> 
  st_transform(6487) |> 
  st_geometry() + list(c(-2500, 0)) 
st_crs(k) <- 6487
k <- st_transform(k, 4326)
k <- st_as_sf(k)
k$StationName <- 'T-3*C'
k$Device <- 'C-POD'
k$geometry <- k$x
k$x <- NULL

mmm <- bind_rows(mmm, k)


mmm <- mmm |> 
  mutate(Device = case_when(Device == 'MARU' ~ 'Rockhopper',
                            Device == 'C-POD' ~ 'FPOD + VR2AR',
                            T ~ Device)
  )
```

```{r}

leaflet() |> 
  setView(lng = -74.7, lat = 38.3, zoom = 10) |> 
  addWMSTiles(
    wms_enc,
    layers = c(0:3, 6),
    options = WMSTileOptions(format = "image/png", transparent = T)
  ) |>
  addPolygons(data = zones, color = 'pink') |>
  addCircleMarkers(data = mmm, label = ~ StationName,
                   group = 'Device',
                   color = ~ colorFactor(c('green', 'red', 'blue', 'black'),
                                         mmm$Device)(Device)) |>
  addLegend(data = mmm,
            colors = c('green', 'red', 'blue', 'black'),
            labels = sort(unique(mmm$Device)),
            group = 'Device') |>
  addMeasure(primaryLengthUnit = 'meters', primaryAreaUnit = 'hectares') |>
  addMiniMap(zoomLevelFixed = 7)
```


